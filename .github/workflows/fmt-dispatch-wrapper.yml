name: FMT Prediction Trigger (Wrapped)

on:
  workflow_dispatch:
    inputs:
      team_1:
        description: "Home team"
        required: true
      team_2:
        description: "Away team"
        required: true
      competition:
        description: "Competition"
        required: true
      date:
        description: "Fixture date (YYYY-MM-DD)"
        required: true

jobs:
  run-fmt-chain:
    name: Run FMT Core Chain
    runs-on: ubuntu-22.04

    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v3

      - name: 🛠 Create fixture-input.json
        run: |
          echo '{
            "fixture_filter": {
              "date": "${{ github.event.inputs.date }}",
              "date_end": "${{ github.event.inputs.date }}",
              "teams": ["${{ github.event.inputs.team_1 }}", "${{ github.event.inputs.team_2 }}"],
              "competition": "${{ github.event.inputs.competition }}"
            }
          }' > fixture-input.json

      - name: 🚀 Run FMT Engine via Python Script
        run: |
          echo "Running prediction..."
          python3 fmt-core-chain/run-fmt-engine.py fixture-input.json

      - name: 🗂 Create predictions folder if missing
        run: mkdir -p predictions

      - name: 📁 Move result into predictions folder
        run: mv fmt-result-output.json predictions/fmt-result-output.json

      - name: ✅ Commit result back to repo
        run: |
          git config --global user.name "fmt-bot"
          git config --global user.email "bot@fmt.ai"
          git add predictions/fmt-result-output.json
          git commit -m "✅ New prediction result pushed from workflow"
          git push
